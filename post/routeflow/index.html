<!doctype html><html lang=en-us><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=generator content="Wowchemy 4.8.0 for Hugo"><meta name=author content="ç¬¼é¹°"><meta name=description content="ç”¨RouteFlowåœ¨SDNç½‘ç»œä¸­å®ç°è·¯ç”±å™¨"><link rel=alternate hreflang=en-us href=/post/routeflow/><link rel=preconnect href=https://fonts.gstatic.com crossorigin><meta name=theme-color content="#2962ff"><script src=/js/mathjax-config.js></script><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css integrity="sha256-FMvZuGapsJLjouA6k7Eo2lusoAX9i0ShlWFG6qt7SLc=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin=anonymous><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/github.min.css crossorigin=anonymous title=hl-light><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/styles/dracula.min.css crossorigin=anonymous title=hl-dark disabled><script src=https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.2.2/lazysizes.min.js integrity="sha512-TmDwFLhg3UA4ZG0Eb4MIyT1O1Mb+Oww5kFG0uHqXsdbyZz9DcvYQhKpGgNkamAI6h2lGGZq2X8ftOJvF/XjTUg==" crossorigin=anonymous async></script><script src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js integrity crossorigin=anonymous async></script><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap"><link rel=stylesheet href=/css/wowchemy.css><script async src="https://www.googletagmanager.com/gtag/js?id=UA-155136732-3"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments);}
function trackOutboundLink(url,target){gtag('event','click',{'event_category':'outbound','event_label':url,'transport_type':'beacon','event_callback':function(){if(target!=='_blank'){document.location=url;}}});console.debug("Outbound link clicked: "+url);}
function onClickCallback(event){if((event.target.tagName!=='A')||(event.target.host===window.location.host)){return;}
trackOutboundLink(event.target,event.target.getAttribute('target'));}
gtag('js',new Date());gtag('config','UA-155136732-3',{});document.addEventListener('click',onClickCallback,false);</script><link rel=manifest href=/index.webmanifest><link rel=icon type=image/png href=/images/icon_hu0ad9a760d4acc21697f10ad9ba07207a_233385_32x32_fill_lanczos_center_2.png><link rel=apple-touch-icon type=image/png href=/images/icon_hu0ad9a760d4acc21697f10ad9ba07207a_233385_192x192_fill_lanczos_center_2.png><link rel=canonical href=/post/routeflow/><meta property="twitter:card" content="summary_large_image"><meta property="twitter:site" content="@ChenjiaxingXjtu"><meta property="twitter:creator" content="@ChenjiaxingXjtu"><meta property="og:site_name" content="ç¬¼é¹°çš„è‡ªä¹ å®¤"><meta property="og:url" content="/post/routeflow/"><meta property="og:title" content="RouteFlow | ç¬¼é¹°çš„è‡ªä¹ å®¤"><meta property="og:description" content="ç”¨RouteFlowåœ¨SDNç½‘ç»œä¸­å®ç°è·¯ç”±å™¨"><meta property="og:image" content="/post/routeflow/featured.jpg"><meta property="twitter:image" content="/post/routeflow/featured.jpg"><meta property="og:locale" content="en-us"><meta property="article:published_time" content="2020-10-07T00:00:00+00:00"><meta property="article:modified_time" content="2020-10-07T00:00:00+00:00"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"/post/routeflow/"},"headline":"RouteFlow","image":["/post/routeflow/featured.jpg"],"datePublished":"2020-10-07T00:00:00Z","dateModified":"2020-10-07T00:00:00Z","author":{"@type":"Person","name":"ç¬¼é¹°"},"publisher":{"@type":"Organization","name":"ç¬¼é¹°çš„è‡ªä¹ å®¤","logo":{"@type":"ImageObject","url":"/images/icon_hu0ad9a760d4acc21697f10ad9ba07207a_233385_192x192_fill_lanczos_center_2.png"}},"description":"ç”¨RouteFlowåœ¨SDNç½‘ç»œä¸­å®ç°è·¯ç”±å™¨"}</script><html><head><meta name=baidu-site-verification content="code-sfn1yFAEKV"><title>ç¬¼é¹°çš„è‡ªä¹ å®¤</title><script>(function(){var bp=document.createElement('script');var curProtocol=window.location.protocol.split(':')[0];if(curProtocol==='https'){bp.src='https://zz.bdstatic.com/linksubmit/push.js';}else{bp.src='http://push.zhanzhang.baidu.com/push.js';}
var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(bp,s);})();</script><script>var _hmt=_hmt||[];(function(){var hm=document.createElement("script");hm.src="https://hm.baidu.com/hm.js?8bac0bb1daa46026753cf161e82b48ad";var s=document.getElementsByTagName("script")[0];s.parentNode.insertBefore(hm,s);})();</script></head></html><title>RouteFlow | ç¬¼é¹°çš„è‡ªä¹ å®¤</title></head><body id=top data-spy=scroll data-offset=70 data-target=#TableOfContents><script>window.wcDarkLightEnabled=true;</script><script>const isSiteThemeDark=false;</script><script src=/js/load-theme.js></script><aside class=search-results id=search><div class=container><section class=search-header><div class="row no-gutters justify-content-between mb-3"><div class=col-6><h1>Search</h1></div><div class="col-6 col-search-close"><a class=js-search href=#><i class="fas fa-times-circle text-muted" aria-hidden=true></i></a></div></div><div id=search-box><input name=q id=search-query placeholder=Search... autocapitalize=off autocomplete=off autocorrect=off spellcheck=false type=search class=form-control></div></section><section class=section-search-results><div id=search-hits></div></section></div></aside><nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id=navbar-main><div class=container><div class="d-none d-lg-inline-flex"><a class=navbar-brand href=/>ç¬¼é¹°çš„è‡ªä¹ å®¤</a></div><button type=button class=navbar-toggler data-toggle=collapse data-target=#navbar-content aria-controls=navbar aria-expanded=false aria-label="Toggle navigation">
<span><i class="fas fa-bars"></i></span></button><div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none"><a class=navbar-brand href=/>ç¬¼é¹°çš„è‡ªä¹ å®¤</a></div><div class="navbar-collapse main-menu-item collapse justify-content-start" id=navbar-content><ul class="navbar-nav d-md-inline-flex"><li class=nav-item><a class=nav-link href=/#about><span>Home</span></a></li><li class=nav-item><a class=nav-link href=/#posts><span>Posts</span></a></li><li class=nav-item><a class=nav-link href=/#projects><span>Projects</span></a></li><li class=nav-item><a class=nav-link href=/#contact><span>Contact</span></a></li></ul></div><ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2"><li class=nav-item><a class="nav-link js-search" href=# aria-label=Search><i class="fas fa-search" aria-hidden=true></i></a></li><li class="nav-item dropdown theme-dropdown"><a href=# class=nav-link data-toggle=dropdown aria-haspopup=true><i class="fas fa-moon" aria-hidden=true></i></a><div class=dropdown-menu><a href=# class="dropdown-item js-set-theme-light"><span>Light</span></a>
<a href=# class="dropdown-item js-set-theme-dark"><span>Dark</span></a>
<a href=# class="dropdown-item js-set-theme-auto"><span>Automatic</span></a></div></li></ul></div></nav><article class=article><div class="article-container pt-3"><h1>RouteFlow</h1><div class=article-metadata><div><span><a href=/author/%E7%AC%BC%E9%B9%B0/>ç¬¼é¹°</a></span></div><span class=article-date>2020-10-07</span>
<span class=middot-divider></span><span class=article-reading-time>3 min read</span>
<span class=middot-divider></span><span class=article-categories><i class="fas fa-folder mr-1"></i><a href=/category/%E6%8A%80%E6%9C%AF/>æŠ€æœ¯</a></span></div></div><div class=article-container><div class=article-style><h1 id=routeflow>Routeflow</h1><p>åœ¨openflowç½‘ç»œä¹‹ä¸Šæä¾›è™šæ‹ŸIPè·¯ç”±æœåŠ¡çš„å¹³å°ã€‚å®ƒä¾èµ–äºPOX,OpenFlow,MongoDB,OVS,Quagga</p><ul><li><a href=https://github.com/routeflow/RouteFlow>https://github.com/routeflow/RouteFlow</a> å®˜æ–¹ä»£ç </li></ul><h2 id=ç¬¬ä¸‰æ–¹ä»£ç >ç¬¬ä¸‰æ–¹ä»£ç </h2><ul><li><a href=https://github.com/chesteve/RouteFlowVM>https://github.com/chesteve/RouteFlowVM</a> è™šæ‹Ÿæœº</li><li><a href=https://github.com/call518/SDN-TEST>https://github.com/call518/SDN-TEST</a> ONOS OpenDaylight Routeflowdç­‰</li><li><a href=https://github.com/hungys/RoutingFlow(>https://github.com/hungys/RoutingFlow(</a>åœ¨Ryuä¸Šå®ç°RIP,OSPFè·¯ç”±åè®®)</li></ul><h2 id=ä¸‰å¤§æ ¸å¿ƒç»„ä»¶>ä¸‰å¤§æ ¸å¿ƒç»„ä»¶</h2><ul><li><strong>RFClient</strong> : è¿è¡Œåœ¨VMï¼ˆå‡†ç¡®è¯´æ˜¯lxcå®¹å™¨ï¼‰ä¸­çš„å®ˆæŠ¤ç¨‹åºï¼Œç›‘æµ‹Linux ARP ,è·¯ç”±è¡¨çš„æ”¹å˜ã€‚å¦‚æœæœ‰æ›´æ–°ï¼Œè·¯ç”±ä¿¡æ¯ä¼šè¢«å‘é€ç»™RFserverã€‚</li><li><strong>RFServer</strong> : ä¸€ä¸ªç‹¬ç«‹çš„appï¼Œç”¨æ¥è¿æ¥å¹¶ç®¡ç†è¿è¡Œåœ¨VMä¸­çš„RFClientå®ä¾‹ã€‚RFserverè´Ÿè´£ç»´æŠ¤RFclientå®ä¾‹ã€æ¥å£å’Œå¯¹åº”äº¤æ¢æœºã€ç«¯å£çš„æ˜ å°„å…³ç³»ã€‚å®ƒä¹Ÿå’Œä¸RFproxyè¿æ¥ï¼Œæ¥é…ç½®æµè¡¨</li><li><strong>RFProxy</strong> ï¼šPOXçš„ä¸€ä¸ªapp,é€šè¿‡openflowåè®®ä¸ovsäº¤äº’ï¼Œç›‘å¬RFserverçš„æŒ‡ä»¤ï¼Œ</li></ul><h2 id=vmrfclientå’Œovsçš„æ˜ å°„å…³ç³»>VMï¼ˆRFclientï¼‰å’ŒOVSçš„æ˜ å°„å…³ç³»</h2><p>é…ç½®è¢«å­˜å‚¨åœ¨MongoDBä¸€ä¸ªé›†åˆä¸­</p><ul><li>VM å’ŒOVSçš„æ˜ å°„å…³ç³»</li><li>virtual interfaceå’Œäº¤æ¢æœºç«¯å£çš„æ˜ å°„å…³ç³»beyond 1:1</li><li>å¤šä¸ªæ§åˆ¶å™¨ç®¡ç†ç½‘ç»œ</li></ul><table><thead><tr><th>æ ¼å¼</th><th>ç±»å‹</th></tr></thead><tbody><tr><td>vm id, vm port, -, -, -, -, -</td><td>é—²ç½®çš„client port</td></tr><tr><td>-, -, -, -, dp id, dp port, ct id</td><td>é—²ç½®çš„datapath port</td></tr><tr><td>vm id, vm port, dp id, dp port, -, -, ct id</td><td>client-datapathæ˜ å°„å…³ç³»</td></tr><tr><td>vm id, vm port, dp id, dp port, vs id, vs port, ct id</td><td>æ¿€æ´»çš„ client-datapath</td></tr><tr><td>å…¶ä»–ä¸è™šæ‹Ÿäº¤æ¢æœºç›¸å…³çš„åŸŸ (vs_*)åœ¨è¿è¡Œæ—¶å®šä¹‰. The ct_id field æ ‡è¯†äº¤æ¢æœºè¿æ¥çš„æ§åˆ¶å™¨.(æ­¤æœºåˆ¶å…è®¸å¤šæ§åˆ¶å™¨ï¼‰</td><td></td></tr></tbody></table><p>çŠ¶æ€å›¾ï¼š
<img src=https://raw.githubusercontent.com/wiki/routeflow/RouteFlow/images/rfstates.png align=center></p><p>å½“äº¤æ¢æœºè¿å…¥ç½‘ç»œï¼ŒRFproxyä¼šå‘ŠçŸ¥RFserveräº¤æ¢æœºçš„æ¯ä¸ªç‰©ç†ç«¯å£ã€‚è¿™äº›datapathç«¯å£è¢«serveræ³¨å†Œä½œä¸ºç©ºé—²çš„datapathç«¯å£æˆ–ä½œä¸ºclient-datapathå…³è”ï¼›å‰è€…å‘ç”Ÿçš„æ¡ä»¶æ˜¯è¦ä¹ˆ<strong>æ­£åœ¨è¢«æ³¨å†Œçš„datapathç«¯å£æ²¡æœ‰configuration</strong>ï¼Œè¦ä¹ˆ<strong>å·²é…ç½®çš„clientç«¯å£ï¼ˆä¸æ­¤datapathç«¯å£å…³è”ï¼‰å°šæœªæ³¨å†Œ</strong>ã€‚ åè€…å‘ç”Ÿçš„æ¡ä»¶æ˜¯åœ¨<strong>clientç«¯å£ï¼ˆåŸºäºthe configurationä¸æ­¤datapathå…³è”ï¼‰è¢«æ³¨å†Œä¸ºç©ºé—²</strong>ã€‚</p><p>å½“ä¸€ä¸ªRFclientå¯åŠ¨ï¼Œä»–ä¼šå‘Šè¯‰serverå®ƒçš„ç«¯å£ã€‚è¿™äº›clientç«¯å£è¢«serveræ³¨å†Œä½œä¸ºç©ºé—²çš„clientç«¯å£æˆ–client-datapathå…³è”ã€‚å’Œä¸Šæ–‡çš„datapathç«¯å£è¡Œä¸ºæè¿°ç±»ä¼¼ã€‚</p><p>å…³è”ä¹‹åï¼ŒRFserverè¦æ±‚clientè§¦å‘ä¸€ä¸ªæ¶ˆæ¯ï¼Œè¿™ä¸ªæ¶ˆæ¯å°†é€šè¿‡clientè¿æ¥çš„è™šæ‹Ÿäº¤æ¢æœºåˆ°è¾¾proxyã€‚è¿™æ ·proxyèƒ½æ„ŸçŸ¥clientå’Œè™šæ‹Ÿäº¤æ¢æœºä¹‹é—´çš„è¿æ¥ï¼Œé€šçŸ¥serverã€‚
ç„¶åserverå†³å®šæ€ä¹ˆå¤„ç†è¿™ä¸ªä¿¡æ¯ã€‚ä¸€èˆ¬åœ°ï¼Œproxyä¼šè¢«å‘½ä»¤é‡å®šå‘æ‰€æœ‰ä»è™šæ‹Ÿäº¤æ¢æœºåˆ°ä¸å®ƒå…³è”çš„ç‰©ç†äº¤æ¢æœºçš„æµï¼Œand vice-versaï¼ˆåä¹‹äº¦ç„¶ï¼‰.</p><p>å½“äº¤æ¢æœºæ–­å¼€ç½‘ç»œï¼Œå®ƒçš„ç«¯å£ä»æ‰€æœ‰æ¶‰åŠåˆ°çš„å…³è”ä¸­ç§»é™¤ï¼Œç•™ä¸‹ç©ºé—²çš„clientç«¯å£ã€‚å¦‚æœdatapathå›æ¥äº†ï¼Œç³»ç»Ÿå°†æŠŠå®ƒå½“ä½œæ–°çš„datapathï¼Œå¦‚ä¸Šæ–‡æè¿°.</p><h3 id=lxcç®€ä»‹>LXCç®€ä»‹</h3><p>Linux Containerå®¹å™¨æ˜¯ä¸€ç§å†…æ ¸è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œç®€ç§°LXCã€‚æä¾›è½»é‡çº§çš„è™šæ‹ŸåŒ–ï¼Œä»¥ä¾¿éš”ç¦»è¿›ç¨‹å’Œèµ„æºï¼Œä½¿ç”¨ LXC çš„ä¼˜ç‚¹å°±æ˜¯ä¸éœ€è¦å®‰è£…å¤ªå¤šçš„è½¯ä»¶åŒ…ï¼Œä½¿ç”¨è¿‡ç¨‹ä¹Ÿä¸ä¼šå ç”¨å¤ªå¤šçš„èµ„æºã€‚LXC åœ¨èµ„æºç®¡ç†æ–¹é¢ä¾èµ– Linux å†…æ ¸çš„ cgroups ï¼ˆControl Groupsï¼‰ ç³»ç»Ÿï¼Œcgroups ç³»ç»Ÿæ˜¯ Linux å†…æ ¸æä¾›çš„ä¸€ä¸ªåŸºäºè¿›ç¨‹ç»„çš„èµ„æºç®¡ç†çš„æ¡†æ¶ï¼Œå¯ä»¥ä¸ºç‰¹å®šçš„è¿›ç¨‹ç»„é™å®šå¯ä»¥ä½¿ç”¨çš„èµ„æºã€‚</p><h3 id=lxcå¸¸ç”¨å‘½ä»¤>lxcå¸¸ç”¨å‘½ä»¤</h3><pre><code class=language-sh>1. å®‰è£…lxc
    apt-get -y --force-yes install lxc
2. æ£€æŸ¥
    lxc-checkconfig å¦‚æœæ‰€æœ‰é¡¹ç›®æ˜¾ç¤ºâ€œenabledâ€åˆ™OK
3. æ ¹æ®æ¨¡æ¿åˆ›å»ºå®¹å™¨
lxc-create -t ubuntu -n base
#-næ˜¯å®¹å™¨çš„åå­—;-t  æ˜¯å®¹å™¨çš„æ¨¡æ¿ï¼ˆæ¨¡æ¿çš„ä¿å­˜è·¯å¾„æ˜¯ï¼š/usr/lib/lxc/templates/==æ¨¡æ¿éƒ½æ˜¯ä¸€ä¸ªè„šæœ¬æ–‡ä»¶ï¼Œæ‰§è¡Œäº†ä¸€ç³»åˆ—æ“ä½œï¼ŒåŒ…æ‹¬åˆ›å»ºå®¹å™¨çš„æ—¶å€™æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿï¼Œé…ç½®ç½‘ç»œï¼Œå®‰è£…å¿…è¦è½¯ä»¶ï¼Œåˆ›å»ºç”¨æˆ·/å±ç»„ï¼Œè®¾ç½®å¯†ç ç­‰=
4. å¯åŠ¨ LXC è™šæ‹Ÿè®¡ç®—æœº
    lxc-start -n testA ç¡®è®¤è´¦å·å’Œå¯†ç åç™»å½•è™šæ‹Ÿè®¡ç®—æœº
6ã€åˆ—å‡ºå½“å‰æ‰€æœ‰çš„å®¹å™¨
ã€€ã€€lxc-ls
7ã€ä½¿ç”¨ console ç™»å…¥å®¹å™¨
    lxc-console -n testA â€“t 3
8ã€åœæ­¢è¿è¡Œä¸€ä¸ªå®¹å™¨
    lxc-stop -n testA
9ã€è·å–ä¸€ä¸ªå®¹å™¨çš„çŠ¶æ€
    lxc-info -n ol6ctr1
10ã€æŠŠä¸€ä¸ªå®¹å™¨é”€æ¯
     lxc-destroy -n testA1
11ã€å¤åˆ¶ä¸€ä¸ªå®¹å™¨
    lxc-clone -o testA -n ol6ctr2
12ã€æš‚åœæˆ–æ¢å¤ä¸€ä¸ªå®¹å™¨
    lxc-freeze -n testA
    lxc-unfreeze -n testA
13ã€ä¿®æ”¹ LXC ç½‘ç»œæ¥å£
    vi /etc/default/lxc
14. ç”¨æˆ·ä¿®æ”¹åè¦é‡æ–°å¯åŠ¨ç½‘ç»œæœåŠ¡
    service lxc-net restart
</code></pre><h2 id=å®éªŒ>å®éªŒ</h2><h3 id=ç¼–è¯‘rfclient>ç¼–è¯‘rfclient</h3><pre><code class=language-sh>make rfclient
</code></pre><p>#make build -> lib -> rfclient:<br>ç¼–è¯‘rflib/ipc, rflib/types, rfclient/. ç›®å½•ä¸‹çš„æ–‡ä»¶åˆ° build/</p><pre><code class=language-sh>./Makefile
export ROOT_DIR=.
export BUILD_DIR=./build
export LIB_DIR=./rflib
export MONGO_DIR=/usr/local/include/mongo
# ç¼–è¯‘äº§ç‰©å­˜æ”¾ç›®å½•
export BUILD_LIB_DIR=./build/lib
export BUILD_OBJ_DIR=./build/obj 

export libdirs := ipc types ï¼ˆrflibä¸‹çš„ä¸¤ä¸ªç›®å½•ï¼‰
</code></pre><h3 id=åˆ›å»ºlxcå®¹å™¨åˆ‡åˆ°rftestç›®å½•æ‰§è¡Œcreate>åˆ›å»ºLXCå®¹å™¨ï¼šåˆ‡åˆ°rftestç›®å½•,æ‰§è¡Œ./create</h3><p>createè„šæœ¬å†…å®¹ï¼š</p><ol><li>å®¹å™¨åˆ›å»ºè·¯å¾„/var/lib/lxc</li><li>aptå®‰è£…lxc</li><li>åˆ›å»ºé»˜è®¤LXCå®¹å™¨base</li></ol><pre><code>lxc-create -t ubuntu -n base
-næ˜¯å®¹å™¨çš„åå­—;-t  æ˜¯å®¹å™¨çš„æ¨¡æ¿ï¼ˆåœ¨/usr/lib/lxc/templates/é‡Œï¼Œæ¨¡æ¿å°±æ˜¯ä¸€ä¸ªè„šæœ¬æ–‡ä»¶ï¼Œå†…å®¹åŒ…æ‹¬åˆ›å»ºå®¹å™¨çš„æ—¶å€™æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿï¼Œé…ç½®ç½‘ç»œï¼Œå®‰è£…å¿…è¦è½¯ä»¶ï¼Œåˆ›å»ºç”¨æˆ·/å±ç»„ï¼Œè®¾ç½®å¯†ç ç­‰==ï¼‰
</code></pre><ol start=4><li>å®‰è£…quaggaã€tcpdumpåˆ°å®¹å™¨</li></ol><pre><code class=language-sh>chroot $LXCDIR/base/rootfs apt-get install
#chrootå‘½ä»¤ç”¨æ¥åœ¨æŒ‡å®šçš„æ ¹ç›®å½•ä¸‹è¿è¡ŒæŒ‡ä»¤
</code></pre><ol start=5><li>åŸºäºåˆšåˆšåˆ›å»ºçš„baseå®¹å™¨å’Œrftest/conifgä¸‹çš„å®¹å™¨é…ç½®æ–‡ä»¶ï¼Œå…‹éš†å…¶ä»–LXCå®¹å™¨</li></ol><h3 id=1rftest1>1)rftest1</h3><p>åˆ›å»º3ä¸ªLXCå®¹å™¨b1(172.31.1.2)ã€b2(172.31.2.2)ã€rfvm1ï¼ˆ192.169.1.100ï¼‰å…¶ä¸­rfvm1åˆ†åˆ«é…ä¸¤ä¸ªinterfaceä¸b1,b2è¿æ¥ã€‚è®¾æ³•ä½¿rfvm1å……å½“ç½‘å…³ï¼ˆè·¯ç”±å™¨ï¼‰ï¼Œä½¿å¾—b1 èƒ½ping é€š b2ã€‚
<img src=https://github.com/routeflow/RouteFlow/wiki/images/rftest1_scenario.png alt=image></p><p>RFä¸­çš„ä¸€å°è™šæ‹Ÿæœºå……å½“openflowäº¤æ¢æœºï¼Œè¿™å°è™šæ‹Ÿæœºä¸­è·¯ç”±è¡¨å’Œarpè¡¨å‘ç”Ÿä»»ä½•äº‹ï¼Œéƒ½è¢«å¤åˆ¶åˆ°äº¤æ¢æœºã€‚ RFClientè´Ÿè´£ç›‘å¬è¿™äº›è¡¨çš„äº‹ä»¶å¹¶ä¸”é€šçŸ¥rfserverã€‚<br>å› æ­¤è¦éƒ¨ç½²ä¸€å°LXCå®¹å™¨,å¦é…ä¸€ä¸ªifaceä½œä¸ºç®¡ç†æ¥å£è¿æ¥è¿™ä¸ªRFclientå’Œå…¶ä»–<br><strong>configæ–‡ä»¶:</strong>
æ­¤æ–‡ä»¶æ˜¯æ‰€æœ‰setupçš„åŸºç¡€ï¼Œæ ¹æ®æƒ…å†µä¿®æ”¹åå­—å’Œhwaddr<br>ç¬¬ä¸€ä¸ªiface(rfvm1.0)çš„hwaddrå°†è¢«ç”¨ä¸ºRFclientçš„ID.</p><pre><code class=language-sh>lxc.utsname = rfvm1
lxc.network.type = veth
lxc.network.flags = up
lxc.network.hwaddr = 12:a0:a0:a0:a0:a0
lxc.network.link=lxcbr0

lxc.network.type = veth
lxc.network.flags = up
lxc.network.veth.pair= rfvm1.1 
lxc.network.hwaddr = 12:a1:a1:a1:a1:a1

lxc.network.type = veth
lxc.network.flags = up
lxc.network.veth.pair = rfvm1.2
lxc.network.hwaddr = 12:a2:a2:a2:a2:a2
...
lxc.rootfs = /var/lib/lxc/rfvm1/rootfs
lxc.mount  = /var/lib/lxc/rfvm1/fstab
</code></pre><p>rootfså’Œmountä¸ç”¨ä¿®æ”¹ã€‚å®¹å™¨çš„ä½ç½®ä¸€èˆ¬åœ¨ <strong>/var/lib/lxc</strong>
<strong>/etc/sysctl.conf</strong> ä¸­å¼€å¯IPv4è½¬å‘ï¼Œè®©rfvm1ä½œä¸ºç½‘å…³ï¼Œå…³é—­quagga
<strong>/etc/rc.local</strong>è°ƒç”¨<strong>root/run_rfclientè„šæœ¬</strong>å¼€å¯RFclientå®ä¾‹ã€‚</p><p>==ReadMe==ï¼šAll these customizations, when structured like in the rftest/config/rfvm1 folder will be read the the rftest/create script, that will create any number of LXC containers based on a basic template.</p><h4 id=æ‰§è¡Œrftest1>æ‰§è¡Œ./rftest1</h4><p>æ­¤è„šæœ¬å¿…é¡»è¢«rootç”¨æˆ·æ‰§è¡Œã€‚<br>ä¸€ã€é‡ç½®ç¯å¢ƒ:</p><pre><code class=language-sh>reset 1ï¼š
åˆå§‹åŒ–ovs:åˆ é™¤dp0,switch1ç½‘æ¡¥
åˆå§‹åŒ–VMsï¼šlxcå…³æœºï¼Œåˆ é™¤vmè·¯å¾„ä¸‹çš„rootfs/var/run/network/ifstate
æ–­å¼€mongodbï¼Œåˆ é™¤æ•°æ®rfvm1è·¯å¾„ä¸‹çš„rootfs/opt/rfclient
trap &quot;reset 0; exit 0&quot; INT
#å½“è„šæœ¬ç¨‹åºæ”¶åˆ°INTå‘½ä»¤ï¼ˆè¢«ä¸­æ–­æ—¶ï¼‰ï¼Œæ‰§è¡Œreset 0; exit 0å®Œæˆæ¸…ç†å·¥ä½œ
é…ç½®å®¹å™¨çš„ç®¡ç†æ¥å£ï¼šifconfig lxcbr0 $MONGODB_ADDR(192.168.10.1) up
sed -i &quot;/bind_ip/c\bind_ip = 127.0.0.1,$MONGODB_ADDR&quot; $MONGODB_CON
#ç”¨bind_ip=127.0.0.1,192.168.10.1å–ä»£bind_ipè¡Œ
é‡å¯mongodb
wait_port_listen $MONGODB_PORT(27017)
# é˜»å¡æ‰§è¡Œç›´åˆ°åœ¨æŒ‡å®šç«¯å£ç›‘å¬åˆ°ä¸€ä¸ªsocketå¼€å¯ã€‚
# MongoDBæœåŠ¡å™¨ï¼šç›‘å¬æ­¤ç½‘æ¡¥ï¼Œç¡®ä¿å®¹å™¨èƒ½è¿æ¥åˆ° Routeflowæ¶æ„ã€‚
</code></pre><p>äºŒã€é…ç½®LXC å®¹å™¨<strong>rfvm1</strong>ä½œä¸ºRFclientè¿è¡Œ</p><pre><code>æ–°å»ºrfclientç›®å½•
mkdir /var/lib/lxc/rfvm1/rootfs/opt/rfclient
å¤åˆ¶rfclientå¯æ‰§è¡Œç¨‹åº
cp build/rfclient   /var/lib/lxc/rfvm1/rootfs/opt/rfclient/rfclient
åˆ›å»ºè„šæœ¬run_rfclient.shåœ¨/var/lib/lxc/rfvm1/rootfs/rootä¸‹ç”¨äºå¯åŠ¨RFclient ï¼ˆè„šæœ¬å†…å®¹ï¼šsleep 5
/opt/rfclient/rfclient&gt; /var/log/rfclient.logï¼‰
å¯åŠ¨pox
#ä½œä¸ºæ§åˆ¶å™¨appçš„RFproxyä¹Ÿéšä¹‹å¯åŠ¨,æ§åˆ¶å™¨æ—¥å¿—ç­‰çº§è®¾ä¸ºINFO
wait_port_listen $Contorller_PORT(6633)
å¯åŠ¨rfserver
./rfserver/rfserver.py rftest/rftest1config.csv &amp;
# rftest1config.csvæ˜¯vm_id,vm_port,ct_id,dp_id,dp_portæ˜ å°„è¡¨
å¯åŠ¨å®¹å™¨å¹¶ç™»å½•ï¼šlxc-start -n rfvm1 -d
</code></pre><p>ä¸‰ã€è¿æ¥å®¹å™¨åˆ°æ­£åœ¨è¿è¡Œæ•°æ®åº“æœåŠ¡çš„hosts</p><pre><code class=language-sh>ovsæ·»åŠ ç½‘æ¡¥dp0ï¼Œç«¯å£rfvm1.1ï¼Œrfvm1.2,dpid=7266767372667673
dp0è¿æ¥æ§åˆ¶å™¨ï¼šovs-vsctl set-controller dp0 tcp:127.0.0.1:$CONTROLLER_PORTï¼ˆ6633ï¼‰

å¯åŠ¨hostsï¼ˆå®¹å™¨b1ã€b2)
ovsæ·»åŠ ç½‘æ¡¥switch1,ç«¯å£b1.0ã€b2.0ï¼Œdpid=99
switch1è¿æ¥åˆ°æ§åˆ¶å™¨
</code></pre><p>åœ¨hoståˆ›å»ºovsç½‘æ¡¥ï¼Œè¿æ¥<em>å®¹å™¨çš„ç®¡ç†æ¥å£</em>ï¼ˆrfvm1çš„eth0ï¼‰
<strong>br0</strong>ï¼Œ192.169.1.1ï¼Œè¿™ä¸ªåœ°å€è¢«å†™æ­»åœ¨rflib/defs.hï¼ˆç»™RFclientå’ŒNOX-RFproxyä»¥åŠRFserverå’ŒPOX-RFproxyï¼‰
å››ã€ç™»å½•åˆ°å®¹å™¨host1
lxc-console -n b1ï¼ˆç”¨æˆ·åå¯†ç éƒ½æ˜¯ubuntuï¼‰
åœ¨b1ï¼ˆ172.31.1.2ï¼‰é‡Œping -c 3 172.31.2.2ï¼ˆb2ï¼‰</p><p>pingé€šçš„åŸå› ï¼š
rfserverç»´æŠ¤æ˜ å°„è¡¨</p><table><thead><tr><th>vm_id</th><th>vm_port</th><th>ct_id</th><th>dp_id,dp_port</th></tr></thead><tbody><tr><td>12A0A0A0A0A0</td><td>1</td><td>0</td><td>99</td></tr><tr><td>12A0A0A0A0A0</td><td>2</td><td>0</td><td>99</td></tr><tr><td>å®¹å™¨idæ˜¯12A0A0A0A0A0ï¼Œå®ƒçš„æ¥å£eth1å¯¹åº”dpidï¼ˆswitchï¼‰çš„æ¥å£1,</td><td></td><td></td><td></td></tr><tr><td>æ¥å£eth2å¯¹åº”dpidï¼ˆswitchï¼‰çš„æ¥å£2</td><td></td><td></td><td></td></tr></tbody></table><p>Did you find this page helpful? Consider sharing it ğŸ™Œ</p></div><div class=article-tags><a class="badge badge-light" href=/tag/ovs/>ovs</a>
<a class="badge badge-light" href=/tag/openflow/>openflow</a></div><div class=share-box aria-hidden=true><ul class=share><li><a href="https://twitter.com/intent/tweet?url=/post/routeflow/&text=RouteFlow" target=_blank rel=noopener class=share-btn-twitter><i class="fab fa-twitter"></i></a></li><li><a href="https://www.facebook.com/sharer.php?u=/post/routeflow/&t=RouteFlow" target=_blank rel=noopener class=share-btn-facebook><i class="fab fa-facebook"></i></a></li><li><a href="mailto:?subject=RouteFlow&body=/post/routeflow/" target=_blank rel=noopener class=share-btn-email><i class="fas fa-envelope"></i></a></li><li><a href="https://www.linkedin.com/shareArticle?url=/post/routeflow/&title=RouteFlow" target=_blank rel=noopener class=share-btn-linkedin><i class="fab fa-linkedin-in"></i></a></li><li><a href="whatsapp://send?text=RouteFlow%20/post/routeflow/" target=_blank rel=noopener class=share-btn-whatsapp><i class="fab fa-whatsapp"></i></a></li><li><a href="https://service.weibo.com/share/share.php?url=/post/routeflow/&title=RouteFlow" target=_blank rel=noopener class=share-btn-weibo><i class="fab fa-weibo"></i></a></li></ul></div><div class="media author-card content-widget-hr"><a href=/><img class="avatar mr-3 avatar-circle" src=/author/%E7%AC%BC%E9%B9%B0/avatar_hud1d7835fdb4144130bc67370de929981_31535_270x270_fill_q90_lanczos_center.jpg alt=ç¬¼é¹°></a><div class=media-body><h5 class=card-title><a href=/>ç¬¼é¹°</a></h5><h6 class=card-subtitle>Javaåç«¯å¼€å‘</h6><ul class=network-icon aria-hidden=true><li><a href=/#contact><i class="fas fa-envelope"></i></a></li><li><a href=https://github.com/ChenjiaxingXJTU target=_blank rel=noopener><i class="fab fa-github"></i></a></li><li><a href=https://gitlab.com/ChenjiaxingXJTU target=_blank rel=noopener><i class="fab fa-gitlab"></i></a></li><li><a href=https://twitter.com/ChenjiaxingXJTU target=_blank rel=noopener><i class="fab fa-twitter"></i></a></li><li><a href=https://www.instagram.com/ChenjiaxingXJTU/ target=_blank rel=noopener><i class="fab fa-instagram"></i></a></li><li><a href=https://www.facebook.com/ChenjiaxingXJTU target=_blank rel=noopener><i class="fab fa-facebook"></i></a></li><li><a href=https://telegram.me/ChenjiaxingXJTU target=_blank rel=noopener><i class="fab fa-telegram"></i></a></li><li><a href=https://www.linkedin.com/in/ChenjiaxingXJTU/ target=_blank rel=noopener><i class="fab fa-linkedin"></i></a></li></ul></div></div><section id=comments><div id=disqus_thread></div><script>let disqus_config=function(){};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='https://'+"chenjiaxing"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section><div class="article-widget content-widget-hr"><h3>Related</h3><ul><li><a href=/post/ovs/>ovsé—®é¢˜æ€»ç»“</a></li><li><a href=/post/onos/>bazelç¼–è¯‘onoså‡ºé”™</a></li><li><a href=/post/disk/>linuxç£ç›˜æ‰©å®¹</a></li><li><a href=/post/website/>ä¸ªäººåšå®¢ç»´æŠ¤å‡ºç°çš„é—®é¢˜</a></li><li><a href=/post/mirror/>åŠ å¿«apt/maven/bazel/npm/pipæ‹‰å–é€Ÿåº¦</a></li></ul></div></div></article><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/instant.page/5.1.0/instantpage.min.js integrity="sha512-1+qUtKoh9XZW7j+6LhRMAyOrgSQKenQ4mluTR+cvxXjP1Z54RxZuzstR/H9kgPXQsVB8IW7DMDFUJpzLjvhGSQ==" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/mermaid/8.8.0/mermaid.min.js integrity="sha512-ja+hSBi4JDtjSqc4LTBsSwuBT3tdZ3oKYKd07lTVYmCnTCor56AnRql00ssqnTOR9Ss4gOP/ROGB3SfcJnZkeg==" crossorigin=anonymous title=mermaid></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/highlight.min.js integrity="sha512-TDKKr+IvoqZnPzc3l35hdjpHD0m+b2EC2SrLEgKDRWpxf2rFCxemkgvJ5kfU48ip+Y+m2XVKyOCD85ybtlZDmw==" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.2.0/languages/r.min.js></script><script>const code_highlighting=true;</script><script>const search_config={"indexURI":"/index.json","minLength":1,"threshold":0.3};const i18n={"no_results":"No results found","placeholder":"Search...","results":"results found"};const content_type={'post':"Posts",'project':"Projects",'publication':"Publications",'talk':"Talks",'slides':"Slides"};</script><script id=search-hit-fuse-template type=text/x-template>
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script><script src=https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin=anonymous></script><script src=https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin=anonymous></script><script src=/js/wowchemy.min.4c2bca31150ce93c5a5e43b8a50f22fd.js></script><div class=container><footer class=site-footer><p class=powered-by><span xmlns:dct=http://purl.org/dc/terms/ property="dct:title">This work</span> by <a xmlns:cc=http://creativecommons.org/ns# href=/#about property="cc:attributionName" rel=cc:attributionurl>ç¬¼é¹°</a> is licensed under a <a rel=license href=http://creativecommons.org/licenses/by-sa/4.0/>Creative Commons Attribution-ShareAlike 4.0 International License</a>.<br><a target=_blank href="http://www.beian.gov.cn/portal/registerSystemInfo?recordcode=61010302000452" style=display:inline-block;text-decoration:none;height:20px;line-height:20px><img src=/img/å…¬ç½‘å®‰.png style=float:left>é™•å…¬ç½‘å®‰å¤‡ 61010302000452å·</a><br>&copy; 2020</p><p class=powered-by>Published with
<a href=https://wowchemy.com target=_blank rel=noopener>Wowchemy</a> â€”
the free, <a href=https://github.com/wowchemy/wowchemy-hugo-modules target=_blank rel=noopener>open source</a> website builder that empowers creators.
<span class=float-right aria-hidden=true><a href=# class=back-to-top><span class=button_icon><i class="fas fa-chevron-up fa-2x"></i></span></a></span></p></footer></div><div id=modal class="modal fade" role=dialog><div class=modal-dialog><div class=modal-content><div class=modal-header><h5 class=modal-title>Cite</h5><button type=button class=close data-dismiss=modal aria-label=Close>
<span aria-hidden=true>&#215;</span></button></div><div class=modal-body><pre><code class="tex hljs"></code></pre></div><div class=modal-footer><a class="btn btn-outline-primary my-1 js-copy-cite" href=# target=_blank><i class="fas fa-copy"></i>Copy</a>
<a class="btn btn-outline-primary my-1 js-download-cite" href=# target=_blank><i class="fas fa-download"></i>Download</a><div id=modal-error></div></div></div></div></div></body></html>