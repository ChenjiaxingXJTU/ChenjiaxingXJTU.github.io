<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>ovs | ç¬¼é¹°çš„è‡ªä¹ å®¤</title><link>/tag/ovs/</link><atom:link href="/tag/ovs/index.xml" rel="self" type="application/rss+xml"/><description>ovs</description><generator>Wowchemy (https://wowchemy.com)</generator><language>en-us</language><copyright>This work by ç¬¼é¹° is licensed under a Creative Commons Attribution-ShareAlike 4.0 International License. é™•å…¬ç½‘å®‰å¤‡ 61010302000452å· Â© 2020</copyright><lastBuildDate>Wed, 07 Oct 2020 00:00:00 +0000</lastBuildDate><image><url>/images/icon_hu0ad9a760d4acc21697f10ad9ba07207a_233385_512x512_fill_lanczos_center_2.png</url><title>ovs</title><link>/tag/ovs/</link></image><item><title>ovsé—®é¢˜æ€»ç»“</title><link>/post/ovs/</link><pubDate>Wed, 07 Oct 2020 00:00:00 +0000</pubDate><guid>/post/ovs/</guid><description>&lt;h2 id="inportç­‰äºoutport">inportç­‰äºoutport&lt;/h2>
&lt;p>åœ¨k=6çš„èƒ–æ ‘ä¸Šåšç½‘ç»œéªŒè¯çš„å®éªŒæ—¶ï¼Œå‘ç°äº†ä¸€ç§ç‰¹æ®Šçš„ç½‘ç»œä¸å¯è¾¾æ•…éšœã€‚debugå®šä½åˆ°å¯ç–‘çš„äº¤æ¢æœºèŠ‚ç‚¹ã€‚æœ€ç»ˆåˆ†æå‡ºåŸå› æ˜¯ç¼–è¯‘å™¨åœ¨ä¸¤ä¸ªç›¸è¿çš„äº¤æ¢æœºä¹‹é—´å­˜åœ¨æ¥å›çš„æµè¡¨ã€‚&lt;/p>
&lt;p>ç”±äºç”¨mininetæ„é€ äº†ä¸€ä¸ªç®€å•æ‹“æ‰‘ï¼Œå¿«é€ŸéªŒè¯æˆ‘çš„çŒœæƒ³ï¼šäº¤æ¢æœºä¸èƒ½æŠŠæ•°æ®åŒ…ä»inportå£è¾“å‡ºã€‚&lt;/p>
&lt;p>&lt;a href="https://imgchr.com/i/8D0yXn" target="_blank" rel="noopener">&lt;img src="https://s1.ax1x.com/2020/03/18/8D0yXn.md.png" alt="8D0yXn.md.png">&lt;/a>&lt;/p>
&lt;p>æˆ‘æ„é€ äº†ä¸€ä¸ªç®€å•çš„æ‹“æ‰‘h1-&amp;gt;s1-&amp;gt;s2-&amp;gt;s1-&amp;gt;s3-&amp;gt;h2ï¼Œå‘icmpåŒ…æ—¶å‘ç°æ‰‹åŠ¨å®‰è£…çš„å››æ¡æµè¡¨ï¼Œåªæœ‰s1ã€s2ä¸Šåˆ†åˆ«åŒ¹é…äº†ä¸€æ¬¡ï¼Œè¯´æ˜æ•°æ®åŒ…å¹¶æ²¡æœ‰ä»s2å›åˆ°s1ï¼Œè™½ç„¶åŒ¹é…åˆ°s2ä¸Šçš„inport=1, action=outport:1çš„æµè¡¨ã€‚
googleå‘ç°&lt;a href="https://mailman.stanford.edu/pipermail/openflow-discuss/2015-April/005636.html" target="_blank" rel="noopener">å°†actiosæ”¹ä¸ºIN_PORTå¯ä»¥è§£å†³é—®é¢˜0ã€‚&lt;/a>ã€‚&lt;/p>
&lt;p>è™½ç„¶åŒ¹é…äº†è½¬å‘è§„åˆ™ä½†æ˜¯æ•°æ®åŒ…å´è¢«ä¸¢å¼ƒçš„åŸå› æ˜¯OpenFlow è¦æ±‚äº¤æ¢æœºä¸è¦æŠŠæ•°æ®åŒ…ä» ingressç«¯å£å‘å‡ºã€‚è²Œä¼¼æ˜¯ä¸ºäº†é¿å…è½¬å‘ç¯è·¯å‡ºç°ã€‚ä½†æ˜¯æœ‰æ—¶å€™ç¡®å®æœ‰è¿™ä¸ªéœ€æ±‚ï¼Œè€Œä¸”ä¸ä¼šé€ æˆé—®é¢˜ã€‚å…·ä½“å¯ä»¥ä»é“¾æ¥ä¸­è¿›å»openflowè®ºå›äº†è§£ã€‚&lt;/p>
&lt;h2 id="minineté…ç½®ç½‘å…³">minineté…ç½®ç½‘å…³&lt;/h2>
&lt;p>&lt;strong>pingä¸åœ¨ä¸€ä¸ªç½‘æ®µçš„ä¸»æœºï¼ŒåŒ…ä¼šè½¬åˆ°å­ç½‘çš„ç½‘å…³ã€‚è€Œç›®å‰æ²¡æœ‰é’ˆå¯¹ä¸¤ä¸ªç½‘æ®µè®¾ç½®ç½‘å…³ã€‚&lt;/strong>&lt;/p>
&lt;pre>&lt;code class="language-bash">#ä¿®æ”¹host ip
py h1.setIP('10.0.0.11/24')
py h2.setIP('10.0.1.22/24')
#æŸ¥çœ‹è·¯ç”±è¡¨
h1 netstat â€“rnæˆ–route(æ…¢)
#ç»™h1é…ç½®é»˜è®¤ç½‘å…³ï¼ˆipï¼‰
h1 route add default gw 10.0.0.1 (h1-eth0)
#ç»™h1é…ç½®é™æ€arpè¡¨(é»˜è®¤ç½‘å…³çš„macå¡«host2)
h1 arp -s 10.0.0.1 00:00:00:00:00:02
h2 route add default gw 10.0.1.1
h2 arp -s 10.0.1.1 00:00:00:00:00:01
#æŸ¥çœ‹arpè¡¨
h1 arp -aæˆ–-n
&lt;/code>&lt;/pre>
&lt;p>sudo tcpdump -e -vv -i s1-eth1ï¼ˆ-vvè¯¦ç»†æŠ¥æ–‡ä¿¡æ¯ï¼Œ-eæ˜¾ç¤ºmacï¼Œâ€“iæŒ‡å®šç›‘å¬çš„ç«¯å£ï¼‰&lt;/p>
&lt;p>h1 ping â€“c 1 h2
ç”±äºä¸æ˜¯ä¸€ä¸ªç½‘æ®µçš„ï¼ŒicmpæŠ¥æ–‡çš„macå¡«çš„æ˜¯ç½‘å…³çš„macã€‚&lt;/p>
&lt;pre>&lt;code class="language-bash">æ¸…ç©ºarp
h1 arp -n|awk '/^[1-9]/{print &amp;quot;arp -d &amp;quot; $1}'|sh -x
h2 arp -n|awk '/^[1-9]/{print &amp;quot;arp -d &amp;quot; $1}'|sh -x
&lt;/code>&lt;/pre>
&lt;p>pingä¸é€šæ˜¯å› ä¸º
&lt;strong>h1-eth0ä¼šå‘é€ARPåŒ…è·å–ç½‘å…³çš„macï¼Œè€Œå½“å‰ç½‘å…³åœ°å€ä¸å­˜åœ¨å¯¹åº”è®¾å¤‡ï¼Œå› æ­¤ICMPå°åŒ…å‰è·å–ä¸åˆ°ç›®æ ‡åœ°å€ä¿¡æ¯ï¼Œè€Œå¯¼è‡´ç½‘ç»œä¸å¯è¾¾ã€‚&lt;/strong>&lt;/p>
&lt;p>ï¼ˆå¦‚æœå®éªŒè¿æ¥äº†æ§åˆ¶å™¨ï¼Œå¯ä»¥é€šè¿‡æ§åˆ¶å™¨è·å¾—ç›®æ ‡åœ°å€çš„ä¿¡æ¯ï¼Œå¦‚OpenDaylightåˆ©ç”¨å®ƒé¢„è®¾çš„ARP Proxyã€‚ï¼‰&lt;/p>
&lt;p>è®©ovsçš„ä¸¤ä¸ªç«¯å£æˆä¸ºç½‘å…³&lt;/p>
&lt;pre>&lt;code class="language-bash">mininet&amp;gt; s1 ifconfig s1-eth1 10.0.0.1/24
mininet&amp;gt; s1 ifconfig s1-eth2 10.0.1.1/24
&lt;/code>&lt;/pre>
&lt;p>é…ç½®æµè¡¨è®©arpå’Œicmpæ¶ˆæ¯å¾—åˆ°è½¬å‘&lt;/p>
&lt;pre>&lt;code class="language-bash">å¤„ç†ARPè¯·æ±‚
å½“ç½‘ç®¡çš„ARPæµåˆ°æ¥åï¼Œå°†å…¶äº¤ç»™æœ¬åœ°çš„OVSå¤„ç†ã€‚
mininet&amp;gt; sh ovs-ofctl add-flow s1 &amp;quot;table=0,priority=65535,arp,arp_tpa=10.0.0.1 actions=LOCAL&amp;quot;
mininet&amp;gt; sh ovs-ofctl add-flow s1 &amp;quot;table=0,priority=65535,arp,arp_tpa=10.0.1.1 actions=LOCAL&amp;quot;
å¤„ç†ARPåº”ç­”
è¯¥åº”ç­”å›å¤ç›®æ ‡åœ°å€çš„å‡ºå£ï¼Œæ¯”å¦‚å°†ç›®æ ‡ç½‘ç»œ10.0.0.1çš„åŒ…é€šè¿‡å‡ºå£ç«¯å£1æŠ“å‘å‡ºå»ã€‚ç«¯å£ä¿¡æ¯å¯ä»¥æŸ¥è¯¢å¦‚ä¸‹ï¼š
mininet&amp;gt; sh ovs-vsctl -- --columns=name,ofport list Interface
name : &amp;quot;s1-eth2&amp;quot;
ofport : 2
name : &amp;quot;s1-eth1&amp;quot;
ofport : 1
name : &amp;quot;s1&amp;quot;
ofport : 65534
å¤„ç†åº”ç­”çš„æµè¡¨å¦‚ä¸‹ï¼š
mininet&amp;gt; sh ovs-ofctl add-flow s1 &amp;quot;table=0,priority=1,arp,nw_dst=10.0.0.1,actions=output:1&amp;quot;
mininet&amp;gt; sh ovs-ofctl add-flow s1 &amp;quot;table=0,priority=1,arp,nw_dst=20.0.0.1,actions=output:2&amp;quot;
å¯¹ICMPçš„è¯·æ±‚è¿›è¡Œå¤„ç†ã€‚
ä¸ºäº†ä½¿å¾—æµè¡¨è¡¨è¾¾æ›´æ¸…æ™°ï¼Œæˆ‘ä»¬å°†ICMPè·¯ç”±çš„å¤„ç†æ”¾åœ¨å¦å¤–ä¸€ä¸ªtableå¤„ç†ã€‚ ä¹Ÿå°±æ˜¯åœ¨table0ä¸­è®¾ç½®ä¸€ä¸ªæœ€ä½ä¼˜å…ˆçº§çš„æµï¼Œå°†éARPçš„åŒ…ä¸¢ç»™ä¸‹ä¸€ä¸ªæµè¡¨å¤„ç†ã€‚
mininet&amp;gt; sh ovs-ofctl add-flow s1 &amp;quot;table=0,priority=0,actions=resubmit(,1)&amp;quot;
åœ¨table(1)ä¸­ï¼ŒOVSçš„è§’è‰²æœ‰ç‚¹åƒrouterï¼Œæˆ‘ä»¬éœ€è¦ä¿®æ”¹ICMPå°åŒ…çš„ç›®æ ‡MACåœ°å€ã€‚
mininet&amp;gt; sh ovs-ofctl add-flow s1 &amp;quot;table=1,icmp,nw_dst=10.0.0.1,actions=mod_dl_dst=00:00:00:00:00:01,output:1&amp;quot;
mininet&amp;gt; sh ovs-ofctl add-flow s1 &amp;quot;table=1,icmp,nw_dst=20.0.0.1,actions=mod_dl_dst=00:00:00:00:00:02,output:2&amp;quot;
&lt;/code>&lt;/pre>
&lt;p>##ç”¨Linuxå‘½ä»¤æ­å»ºsdnç½‘ç»œ&lt;/p>
&lt;pre>&lt;code class="language-bash"># Create host namespaces
ip netns add h1
ip netns add h2
# Create switch
ovs-vsctl add-br s1
# Create links
ip link add h1-eth0 type veth peer name s1-eth1
ip link add h2-eth0 type veth peer name s1-eth2
ip link show
# Move host ports into namespaces
ip link set h1-eth0 netns h1
ip link set h2-eth0 netns h2
ip netns exec h1 ip link show
ip netns exec h2 ip link show
# Connect switch ports to OVS
ovs-vsctl add-port s1 s1-eth1
ovs-vsctl add-port s1 s1-eth2
ovs-vsctl show
# Set up OpenFlow controller
ovs-vsctl set-controller s1 tcp:127.0.0.1
ovs-controller ptcp: &amp;amp;
ovs-vsctl show
# Configure network
ip netns exec h1 ifconfig h1-eth0 10.1
ip netns exec h1 ifconfig lo up
ip netns exec h2 ifconfig h2-eth0 10.2
ip netns exec h2 ifconfig lo up
ifconfig s1-eth1 up
ifconfig s1-eth2 up
# Test network
ip netns exec h1 ping -c1 10.2
&lt;/code>&lt;/pre>
&lt;h2 id="mininetä¸»æœºäº’ç›¸å‘åŒ…">mininetä¸»æœºäº’ç›¸å‘åŒ…&lt;/h2>
&lt;p>åœ¨mininet/mininet/ä¸­çš„net.pyä¸­æ·»åŠ å‡½æ•°ï¼š&lt;/p>
&lt;pre>&lt;code class="language-python"> def sendMulti(self, number, period, times):
times=int(times)
#os.system(&amp;quot;ls&amp;quot;)
while (times):
base_port = 5001
host_list = [h for h in self.hosts]
_len = len(host_list)
for i in range(0, _len):
client = host_list[i]
for j in range(0, _len):
server = host_list[j]
if (i != j):
client.cmd(&amp;quot;/home/cjx/ubuntu/mininet/sends&amp;quot; + ' ' + server.IP() + ' ' + number + ' ' + period)
base_port += 1
times = times - 1
&lt;/code>&lt;/pre>
&lt;p>åœ¨mininet/mininet/ä¸­çš„cli.pyä¸­æ·»åŠ å‡½æ•°ï¼š&lt;/p>
&lt;pre>&lt;code class="language-python">def do_sendmulti(self, line):
&amp;quot;&amp;quot;&amp;quot;Multi iperf UDP test between nodes&amp;quot;&amp;quot;&amp;quot;
args = line.split()
if len(args) == 3:
udpBw = args[0]
period = args[1]
times = args[2]
err = False
self.mn.sendMulti(udpBw, period,times)
else:
error('invalid number of args: sendmulti udpBw \n' +
'udpBw examples: 1M\n')
&lt;/code>&lt;/pre>
&lt;p>åœ¨mininet/bin/mnæ–‡ä»¶ä¸­ä¸¤å¤„ä¿®æ”¹ï¼š&lt;/p>
&lt;pre>&lt;code class="language-python">TESTS = { name: True
for name in ( 'pingall', 'pingpair', 'iperf', 'iperfudp', 'sendmulti' ) }
ALTSPELLING = { 'pingall': 'pingAll', 'pingpair': 'pingPair',
'iperfudp': 'iperfUdp',
'sendmulti': 'sendMulti'}
&lt;/code>&lt;/pre>
&lt;p>send.cå‘åŒ…æºæ–‡ä»¶ç¼–è¯‘æˆæ‰§è¡Œæ–‡ä»¶&lt;/p>
&lt;pre>&lt;code class="language-c">int main(int argc, char** argv)
{
///å¿…é¡»æœ‰ç›®çš„ipçš„å‚æ•°
if(argc != 4)
{
printf(&amp;quot;usage: send [ip] [number] [time interval(ms)]\n&amp;quot;);
return -1;
}
///æ ¹æ®å‚æ•°ç»„åˆå‡ºç›®çš„ä¸»æœºçš„ipåœ°å€
char dst_ip[20];
sprintf(dst_ip,&amp;quot;%s&amp;quot;,argv[1]);
int times = atoi(argv[2]);
int time_interval = atoi(argv[3]);
time_interval*=1000;
/// åˆå§‹åŒ–æœ¬æœºåœ°å€
struct sockaddr_in my_addr;
memset(&amp;amp;my_addr,0,sizeof(my_addr));
my_addr.sin_family = AF_INET; //Address family æŒ‡å®šä¸ºipv4
my_addr.sin_addr.s_addr = INADDR_ANY; ////INADDR_ANYè¡¨ç¤ºè‡ªåŠ¨è·å–æœ¬æœºåœ°å€
my_addr.sin_port = htons(8889); ///ç«¯å£å·ï¼ˆæœ¬æœºçš„ç«¯å£å¥½è¡¨ç¤ºç”¨äºå‘é€çš„ç«¯å£å·ï¼‰
///åˆå§‹åŒ–ç›®çš„ä¸»æœºåœ°å€
struct sockaddr_in dst_addr;
memset(&amp;amp;dst_addr,0,sizeof(dst_addr));
dst_addr.sin_family = AF_INET;
dst_addr.sin_addr.s_addr = inet_addr(dst_ip);
dst_addr.sin_port = htons(8888);
///åˆ›å»ºå¥—æ¥å­—
int sockfd = socket(AF_INET,SOCK_DGRAM,0);
if(sockfd == -1)
{
perror(&amp;quot;create socket failed\n&amp;quot;);
return -1;
}
///ç»‘å®šç«¯å£
if(bind(sockfd,(struct sockaddr*)&amp;amp;my_addr,sizeof(my_addr)) == -1)
{
perror(&amp;quot;bind failed\n&amp;quot;);
return -1;
}
unsigned char buf[16];
int i = 0;
for(i=0; i&amp;lt; 16; i++)
{
buf[i] = 0xff;
}
///å‘é€æ•°æ®åŒ…
for(i=0; i&amp;lt;times; i++)
{
usleep(time_interval);
// sleep(1);
printf(&amp;quot;sending packet %d to %s\n&amp;quot;,i,dst_ip);
if(sendto(sockfd,buf,sizeof(buf),0,(struct sockaddr*)&amp;amp;dst_addr,sizeof(dst_addr)) == -1)
{
perror(&amp;quot;send failed\n&amp;quot;);
return -1;
}
}
close(sockfd);
}
&lt;/code>&lt;/pre>
&lt;p>Did you find this page helpful? Consider sharing it ğŸ™Œ&lt;/p></description></item><item><title>RouteFlow</title><link>/post/routeflow/</link><pubDate>Wed, 07 Oct 2020 00:00:00 +0000</pubDate><guid>/post/routeflow/</guid><description>&lt;h1 id="routeflow">Routeflow&lt;/h1>
&lt;p>åœ¨openflowç½‘ç»œä¹‹ä¸Šæä¾›è™šæ‹ŸIPè·¯ç”±æœåŠ¡çš„å¹³å°ã€‚å®ƒä¾èµ–äºPOX,OpenFlow,MongoDB,OVS,Quagga&lt;/p>
&lt;ul>
&lt;li>&lt;a href="https://github.com/routeflow/RouteFlow">https://github.com/routeflow/RouteFlow&lt;/a> å®˜æ–¹ä»£ç &lt;/li>
&lt;/ul>
&lt;h2 id="ç¬¬ä¸‰æ–¹ä»£ç ">ç¬¬ä¸‰æ–¹ä»£ç &lt;/h2>
&lt;ul>
&lt;li>&lt;a href="https://github.com/chesteve/RouteFlowVM">https://github.com/chesteve/RouteFlowVM&lt;/a> è™šæ‹Ÿæœº&lt;/li>
&lt;li>&lt;a href="https://github.com/call518/SDN-TEST">https://github.com/call518/SDN-TEST&lt;/a> ONOS OpenDaylight Routeflowdç­‰&lt;/li>
&lt;li>&lt;a href="https://github.com/hungys/RoutingFlow(">https://github.com/hungys/RoutingFlow(&lt;/a>åœ¨Ryuä¸Šå®ç°RIP,OSPFè·¯ç”±åè®®)&lt;/li>
&lt;/ul>
&lt;h2 id="ä¸‰å¤§æ ¸å¿ƒç»„ä»¶">ä¸‰å¤§æ ¸å¿ƒç»„ä»¶&lt;/h2>
&lt;ul>
&lt;li>&lt;strong>RFClient&lt;/strong> : è¿è¡Œåœ¨VMï¼ˆå‡†ç¡®è¯´æ˜¯lxcå®¹å™¨ï¼‰ä¸­çš„å®ˆæŠ¤ç¨‹åºï¼Œç›‘æµ‹Linux ARP ,è·¯ç”±è¡¨çš„æ”¹å˜ã€‚å¦‚æœæœ‰æ›´æ–°ï¼Œè·¯ç”±ä¿¡æ¯ä¼šè¢«å‘é€ç»™RFserverã€‚&lt;/li>
&lt;li>&lt;strong>RFServer&lt;/strong> : ä¸€ä¸ªç‹¬ç«‹çš„appï¼Œç”¨æ¥è¿æ¥å¹¶ç®¡ç†è¿è¡Œåœ¨VMä¸­çš„RFClientå®ä¾‹ã€‚RFserverè´Ÿè´£ç»´æŠ¤RFclientå®ä¾‹ã€æ¥å£å’Œå¯¹åº”äº¤æ¢æœºã€ç«¯å£çš„æ˜ å°„å…³ç³»ã€‚å®ƒä¹Ÿå’Œä¸RFproxyè¿æ¥ï¼Œæ¥é…ç½®æµè¡¨&lt;/li>
&lt;li>&lt;strong>RFProxy&lt;/strong> ï¼šPOXçš„ä¸€ä¸ªapp,é€šè¿‡openflowåè®®ä¸ovsäº¤äº’ï¼Œç›‘å¬RFserverçš„æŒ‡ä»¤ï¼Œ&lt;/li>
&lt;/ul>
&lt;h2 id="vmrfclientå’Œovsçš„æ˜ å°„å…³ç³»">VMï¼ˆRFclientï¼‰å’ŒOVSçš„æ˜ å°„å…³ç³»&lt;/h2>
&lt;p>é…ç½®è¢«å­˜å‚¨åœ¨MongoDBä¸€ä¸ªé›†åˆä¸­&lt;/p>
&lt;ul>
&lt;li>VM å’ŒOVSçš„æ˜ å°„å…³ç³»&lt;/li>
&lt;li>virtual interfaceå’Œäº¤æ¢æœºç«¯å£çš„æ˜ å°„å…³ç³»beyond 1:1&lt;/li>
&lt;li>å¤šä¸ªæ§åˆ¶å™¨ç®¡ç†ç½‘ç»œ&lt;/li>
&lt;/ul>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>æ ¼å¼&lt;/th>
&lt;th>ç±»å‹&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>vm id, vm port, -, -, -, -, -&lt;/td>
&lt;td>é—²ç½®çš„client port&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>-, -, -, -, dp id, dp port, ct id&lt;/td>
&lt;td>é—²ç½®çš„datapath port&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>vm id, vm port, dp id, dp port, -, -, ct id&lt;/td>
&lt;td>client-datapathæ˜ å°„å…³ç³»&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>vm id, vm port, dp id, dp port, vs id, vs port, ct id&lt;/td>
&lt;td>æ¿€æ´»çš„ client-datapath&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>å…¶ä»–ä¸è™šæ‹Ÿäº¤æ¢æœºç›¸å…³çš„åŸŸ (vs_*)åœ¨è¿è¡Œæ—¶å®šä¹‰. The ct_id field æ ‡è¯†äº¤æ¢æœºè¿æ¥çš„æ§åˆ¶å™¨.(æ­¤æœºåˆ¶å…è®¸å¤šæ§åˆ¶å™¨ï¼‰&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>çŠ¶æ€å›¾ï¼š
&lt;img src="https://raw.githubusercontent.com/wiki/routeflow/RouteFlow/images/rfstates.png" align="center" >&lt;/p>
&lt;p>å½“äº¤æ¢æœºè¿å…¥ç½‘ç»œï¼ŒRFproxyä¼šå‘ŠçŸ¥RFserveräº¤æ¢æœºçš„æ¯ä¸ªç‰©ç†ç«¯å£ã€‚è¿™äº›datapathç«¯å£è¢«serveræ³¨å†Œä½œä¸ºç©ºé—²çš„datapathç«¯å£æˆ–ä½œä¸ºclient-datapathå…³è”ï¼›å‰è€…å‘ç”Ÿçš„æ¡ä»¶æ˜¯è¦ä¹ˆ&lt;strong>æ­£åœ¨è¢«æ³¨å†Œçš„datapathç«¯å£æ²¡æœ‰configuration&lt;/strong>ï¼Œè¦ä¹ˆ&lt;strong>å·²é…ç½®çš„clientç«¯å£ï¼ˆä¸æ­¤datapathç«¯å£å…³è”ï¼‰å°šæœªæ³¨å†Œ&lt;/strong>ã€‚ åè€…å‘ç”Ÿçš„æ¡ä»¶æ˜¯åœ¨&lt;strong>clientç«¯å£ï¼ˆåŸºäºthe configurationä¸æ­¤datapathå…³è”ï¼‰è¢«æ³¨å†Œä¸ºç©ºé—²&lt;/strong>ã€‚&lt;/p>
&lt;p>å½“ä¸€ä¸ªRFclientå¯åŠ¨ï¼Œä»–ä¼šå‘Šè¯‰serverå®ƒçš„ç«¯å£ã€‚è¿™äº›clientç«¯å£è¢«serveræ³¨å†Œä½œä¸ºç©ºé—²çš„clientç«¯å£æˆ–client-datapathå…³è”ã€‚å’Œä¸Šæ–‡çš„datapathç«¯å£è¡Œä¸ºæè¿°ç±»ä¼¼ã€‚&lt;/p>
&lt;p>å…³è”ä¹‹åï¼ŒRFserverè¦æ±‚clientè§¦å‘ä¸€ä¸ªæ¶ˆæ¯ï¼Œè¿™ä¸ªæ¶ˆæ¯å°†é€šè¿‡clientè¿æ¥çš„è™šæ‹Ÿäº¤æ¢æœºåˆ°è¾¾proxyã€‚è¿™æ ·proxyèƒ½æ„ŸçŸ¥clientå’Œè™šæ‹Ÿäº¤æ¢æœºä¹‹é—´çš„è¿æ¥ï¼Œé€šçŸ¥serverã€‚
ç„¶åserverå†³å®šæ€ä¹ˆå¤„ç†è¿™ä¸ªä¿¡æ¯ã€‚ä¸€èˆ¬åœ°ï¼Œproxyä¼šè¢«å‘½ä»¤é‡å®šå‘æ‰€æœ‰ä»è™šæ‹Ÿäº¤æ¢æœºåˆ°ä¸å®ƒå…³è”çš„ç‰©ç†äº¤æ¢æœºçš„æµï¼Œand vice-versaï¼ˆåä¹‹äº¦ç„¶ï¼‰.&lt;/p>
&lt;p>å½“äº¤æ¢æœºæ–­å¼€ç½‘ç»œï¼Œå®ƒçš„ç«¯å£ä»æ‰€æœ‰æ¶‰åŠåˆ°çš„å…³è”ä¸­ç§»é™¤ï¼Œç•™ä¸‹ç©ºé—²çš„clientç«¯å£ã€‚å¦‚æœdatapathå›æ¥äº†ï¼Œç³»ç»Ÿå°†æŠŠå®ƒå½“ä½œæ–°çš„datapathï¼Œå¦‚ä¸Šæ–‡æè¿°.&lt;/p>
&lt;h3 id="lxcç®€ä»‹">LXCç®€ä»‹&lt;/h3>
&lt;p>Linux Containerå®¹å™¨æ˜¯ä¸€ç§å†…æ ¸è™šæ‹ŸåŒ–æŠ€æœ¯ï¼Œç®€ç§°LXCã€‚æä¾›è½»é‡çº§çš„è™šæ‹ŸåŒ–ï¼Œä»¥ä¾¿éš”ç¦»è¿›ç¨‹å’Œèµ„æºï¼Œä½¿ç”¨ LXC çš„ä¼˜ç‚¹å°±æ˜¯ä¸éœ€è¦å®‰è£…å¤ªå¤šçš„è½¯ä»¶åŒ…ï¼Œä½¿ç”¨è¿‡ç¨‹ä¹Ÿä¸ä¼šå ç”¨å¤ªå¤šçš„èµ„æºã€‚LXC åœ¨èµ„æºç®¡ç†æ–¹é¢ä¾èµ– Linux å†…æ ¸çš„ cgroups ï¼ˆControl Groupsï¼‰ ç³»ç»Ÿï¼Œcgroups ç³»ç»Ÿæ˜¯ Linux å†…æ ¸æä¾›çš„ä¸€ä¸ªåŸºäºè¿›ç¨‹ç»„çš„èµ„æºç®¡ç†çš„æ¡†æ¶ï¼Œå¯ä»¥ä¸ºç‰¹å®šçš„è¿›ç¨‹ç»„é™å®šå¯ä»¥ä½¿ç”¨çš„èµ„æºã€‚&lt;/p>
&lt;h3 id="lxcå¸¸ç”¨å‘½ä»¤">lxcå¸¸ç”¨å‘½ä»¤&lt;/h3>
&lt;pre>&lt;code class="language-sh">1. å®‰è£…lxc
apt-get -y --force-yes install lxc
2. æ£€æŸ¥
lxc-checkconfig å¦‚æœæ‰€æœ‰é¡¹ç›®æ˜¾ç¤ºâ€œenabledâ€åˆ™OK
3. æ ¹æ®æ¨¡æ¿åˆ›å»ºå®¹å™¨
lxc-create -t ubuntu -n base
#-næ˜¯å®¹å™¨çš„åå­—;-t æ˜¯å®¹å™¨çš„æ¨¡æ¿ï¼ˆæ¨¡æ¿çš„ä¿å­˜è·¯å¾„æ˜¯ï¼š/usr/lib/lxc/templates/==æ¨¡æ¿éƒ½æ˜¯ä¸€ä¸ªè„šæœ¬æ–‡ä»¶ï¼Œæ‰§è¡Œäº†ä¸€ç³»åˆ—æ“ä½œï¼ŒåŒ…æ‹¬åˆ›å»ºå®¹å™¨çš„æ—¶å€™æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿï¼Œé…ç½®ç½‘ç»œï¼Œå®‰è£…å¿…è¦è½¯ä»¶ï¼Œåˆ›å»ºç”¨æˆ·/å±ç»„ï¼Œè®¾ç½®å¯†ç ç­‰=
4. å¯åŠ¨ LXC è™šæ‹Ÿè®¡ç®—æœº
lxc-start -n testA ç¡®è®¤è´¦å·å’Œå¯†ç åç™»å½•è™šæ‹Ÿè®¡ç®—æœº
6ã€åˆ—å‡ºå½“å‰æ‰€æœ‰çš„å®¹å™¨
ã€€ã€€lxc-ls
7ã€ä½¿ç”¨ console ç™»å…¥å®¹å™¨
lxc-console -n testA â€“t 3
8ã€åœæ­¢è¿è¡Œä¸€ä¸ªå®¹å™¨
lxc-stop -n testA
9ã€è·å–ä¸€ä¸ªå®¹å™¨çš„çŠ¶æ€
lxc-info -n ol6ctr1
10ã€æŠŠä¸€ä¸ªå®¹å™¨é”€æ¯
lxc-destroy -n testA1
11ã€å¤åˆ¶ä¸€ä¸ªå®¹å™¨
lxc-clone -o testA -n ol6ctr2
12ã€æš‚åœæˆ–æ¢å¤ä¸€ä¸ªå®¹å™¨
lxc-freeze -n testA
lxc-unfreeze -n testA
13ã€ä¿®æ”¹ LXC ç½‘ç»œæ¥å£
vi /etc/default/lxc
14. ç”¨æˆ·ä¿®æ”¹åè¦é‡æ–°å¯åŠ¨ç½‘ç»œæœåŠ¡
service lxc-net restart
&lt;/code>&lt;/pre>
&lt;h2 id="å®éªŒ">å®éªŒ&lt;/h2>
&lt;h3 id="ç¼–è¯‘rfclient">ç¼–è¯‘rfclient&lt;/h3>
&lt;pre>&lt;code class="language-sh">make rfclient
&lt;/code>&lt;/pre>
&lt;p>#make build -&amp;gt; lib -&amp;gt; rfclient:&lt;br> ç¼–è¯‘rflib/ipc, rflib/types, rfclient/. ç›®å½•ä¸‹çš„æ–‡ä»¶åˆ° build/&lt;/p>
&lt;pre>&lt;code class="language-sh">./Makefile
export ROOT_DIR=.
export BUILD_DIR=./build
export LIB_DIR=./rflib
export MONGO_DIR=/usr/local/include/mongo
# ç¼–è¯‘äº§ç‰©å­˜æ”¾ç›®å½•
export BUILD_LIB_DIR=./build/lib
export BUILD_OBJ_DIR=./build/obj
export libdirs := ipc types ï¼ˆrflibä¸‹çš„ä¸¤ä¸ªç›®å½•ï¼‰
&lt;/code>&lt;/pre>
&lt;h3 id="åˆ›å»ºlxcå®¹å™¨åˆ‡åˆ°rftestç›®å½•æ‰§è¡Œcreate">åˆ›å»ºLXCå®¹å™¨ï¼šåˆ‡åˆ°rftestç›®å½•,æ‰§è¡Œ./create&lt;/h3>
&lt;p>createè„šæœ¬å†…å®¹ï¼š&lt;/p>
&lt;ol>
&lt;li>å®¹å™¨åˆ›å»ºè·¯å¾„/var/lib/lxc&lt;/li>
&lt;li>aptå®‰è£…lxc&lt;/li>
&lt;li>åˆ›å»ºé»˜è®¤LXCå®¹å™¨base&lt;/li>
&lt;/ol>
&lt;pre>&lt;code>lxc-create -t ubuntu -n base
-næ˜¯å®¹å™¨çš„åå­—;-t æ˜¯å®¹å™¨çš„æ¨¡æ¿ï¼ˆåœ¨/usr/lib/lxc/templates/é‡Œï¼Œæ¨¡æ¿å°±æ˜¯ä¸€ä¸ªè„šæœ¬æ–‡ä»¶ï¼Œå†…å®¹åŒ…æ‹¬åˆ›å»ºå®¹å™¨çš„æ—¶å€™æŒ‚è½½æ–‡ä»¶ç³»ç»Ÿï¼Œé…ç½®ç½‘ç»œï¼Œå®‰è£…å¿…è¦è½¯ä»¶ï¼Œåˆ›å»ºç”¨æˆ·/å±ç»„ï¼Œè®¾ç½®å¯†ç ç­‰==ï¼‰
&lt;/code>&lt;/pre>
&lt;ol start="4">
&lt;li>å®‰è£…quaggaã€tcpdumpåˆ°å®¹å™¨&lt;/li>
&lt;/ol>
&lt;pre>&lt;code class="language-sh">chroot $LXCDIR/base/rootfs apt-get install
#chrootå‘½ä»¤ç”¨æ¥åœ¨æŒ‡å®šçš„æ ¹ç›®å½•ä¸‹è¿è¡ŒæŒ‡ä»¤
&lt;/code>&lt;/pre>
&lt;ol start="5">
&lt;li>åŸºäºåˆšåˆšåˆ›å»ºçš„baseå®¹å™¨å’Œrftest/conifgä¸‹çš„å®¹å™¨é…ç½®æ–‡ä»¶ï¼Œå…‹éš†å…¶ä»–LXCå®¹å™¨&lt;/li>
&lt;/ol>
&lt;h3 id="1rftest1">1)rftest1&lt;/h3>
&lt;p>åˆ›å»º3ä¸ªLXCå®¹å™¨b1(172.31.1.2)ã€b2(172.31.2.2)ã€rfvm1ï¼ˆ192.169.1.100ï¼‰å…¶ä¸­rfvm1åˆ†åˆ«é…ä¸¤ä¸ªinterfaceä¸b1,b2è¿æ¥ã€‚è®¾æ³•ä½¿rfvm1å……å½“ç½‘å…³ï¼ˆè·¯ç”±å™¨ï¼‰ï¼Œä½¿å¾—b1 èƒ½ping é€š b2ã€‚
&lt;img src="https://github.com/routeflow/RouteFlow/wiki/images/rftest1_scenario.png" alt="image">&lt;/p>
&lt;p>RFä¸­çš„ä¸€å°è™šæ‹Ÿæœºå……å½“openflowäº¤æ¢æœºï¼Œè¿™å°è™šæ‹Ÿæœºä¸­è·¯ç”±è¡¨å’Œarpè¡¨å‘ç”Ÿä»»ä½•äº‹ï¼Œéƒ½è¢«å¤åˆ¶åˆ°äº¤æ¢æœºã€‚ RFClientè´Ÿè´£ç›‘å¬è¿™äº›è¡¨çš„äº‹ä»¶å¹¶ä¸”é€šçŸ¥rfserverã€‚
&lt;br>å› æ­¤è¦éƒ¨ç½²ä¸€å°LXCå®¹å™¨,å¦é…ä¸€ä¸ªifaceä½œä¸ºç®¡ç†æ¥å£è¿æ¥è¿™ä¸ªRFclientå’Œå…¶ä»–&lt;br>
&lt;strong>configæ–‡ä»¶:&lt;/strong>
æ­¤æ–‡ä»¶æ˜¯æ‰€æœ‰setupçš„åŸºç¡€ï¼Œæ ¹æ®æƒ…å†µä¿®æ”¹åå­—å’Œhwaddr&lt;br>
ç¬¬ä¸€ä¸ªiface(rfvm1.0)çš„hwaddrå°†è¢«ç”¨ä¸ºRFclientçš„ID.&lt;/p>
&lt;pre>&lt;code class="language-sh">lxc.utsname = rfvm1
lxc.network.type = veth
lxc.network.flags = up
lxc.network.hwaddr = 12:a0:a0:a0:a0:a0
lxc.network.link=lxcbr0
lxc.network.type = veth
lxc.network.flags = up
lxc.network.veth.pair= rfvm1.1
lxc.network.hwaddr = 12:a1:a1:a1:a1:a1
lxc.network.type = veth
lxc.network.flags = up
lxc.network.veth.pair = rfvm1.2
lxc.network.hwaddr = 12:a2:a2:a2:a2:a2
...
lxc.rootfs = /var/lib/lxc/rfvm1/rootfs
lxc.mount = /var/lib/lxc/rfvm1/fstab
&lt;/code>&lt;/pre>
&lt;p>rootfså’Œmountä¸ç”¨ä¿®æ”¹ã€‚å®¹å™¨çš„ä½ç½®ä¸€èˆ¬åœ¨ &lt;strong>/var/lib/lxc&lt;/strong>
&lt;strong>/etc/sysctl.conf&lt;/strong> ä¸­å¼€å¯IPv4è½¬å‘ï¼Œè®©rfvm1ä½œä¸ºç½‘å…³ï¼Œå…³é—­quagga
&lt;strong>/etc/rc.local&lt;/strong>è°ƒç”¨&lt;strong>root/run_rfclientè„šæœ¬&lt;/strong>å¼€å¯RFclientå®ä¾‹ã€‚&lt;/p>
&lt;p>==ReadMe==ï¼šAll these customizations, when structured like in the rftest/config/rfvm1 folder will be read the the rftest/create script, that will create any number of LXC containers based on a basic template.&lt;/p>
&lt;h4 id="æ‰§è¡Œrftest1">æ‰§è¡Œ./rftest1&lt;/h4>
&lt;p>æ­¤è„šæœ¬å¿…é¡»è¢«rootç”¨æˆ·æ‰§è¡Œã€‚&lt;br>
ä¸€ã€é‡ç½®ç¯å¢ƒ:&lt;/p>
&lt;pre>&lt;code class="language-sh">reset 1ï¼š
åˆå§‹åŒ–ovs:åˆ é™¤dp0,switch1ç½‘æ¡¥
åˆå§‹åŒ–VMsï¼šlxcå…³æœºï¼Œåˆ é™¤vmè·¯å¾„ä¸‹çš„rootfs/var/run/network/ifstate
æ–­å¼€mongodbï¼Œåˆ é™¤æ•°æ®rfvm1è·¯å¾„ä¸‹çš„rootfs/opt/rfclient
trap &amp;quot;reset 0; exit 0&amp;quot; INT
#å½“è„šæœ¬ç¨‹åºæ”¶åˆ°INTå‘½ä»¤ï¼ˆè¢«ä¸­æ–­æ—¶ï¼‰ï¼Œæ‰§è¡Œreset 0; exit 0å®Œæˆæ¸…ç†å·¥ä½œ
é…ç½®å®¹å™¨çš„ç®¡ç†æ¥å£ï¼šifconfig lxcbr0 $MONGODB_ADDR(192.168.10.1) up
sed -i &amp;quot;/bind_ip/c\bind_ip = 127.0.0.1,$MONGODB_ADDR&amp;quot; $MONGODB_CON
#ç”¨bind_ip=127.0.0.1,192.168.10.1å–ä»£bind_ipè¡Œ
é‡å¯mongodb
wait_port_listen $MONGODB_PORT(27017)
# é˜»å¡æ‰§è¡Œç›´åˆ°åœ¨æŒ‡å®šç«¯å£ç›‘å¬åˆ°ä¸€ä¸ªsocketå¼€å¯ã€‚
# MongoDBæœåŠ¡å™¨ï¼šç›‘å¬æ­¤ç½‘æ¡¥ï¼Œç¡®ä¿å®¹å™¨èƒ½è¿æ¥åˆ° Routeflowæ¶æ„ã€‚
&lt;/code>&lt;/pre>
&lt;p>äºŒã€é…ç½®LXC å®¹å™¨&lt;strong>rfvm1&lt;/strong>ä½œä¸ºRFclientè¿è¡Œ&lt;/p>
&lt;pre>&lt;code>æ–°å»ºrfclientç›®å½•
mkdir /var/lib/lxc/rfvm1/rootfs/opt/rfclient
å¤åˆ¶rfclientå¯æ‰§è¡Œç¨‹åº
cp build/rfclient /var/lib/lxc/rfvm1/rootfs/opt/rfclient/rfclient
åˆ›å»ºè„šæœ¬run_rfclient.shåœ¨/var/lib/lxc/rfvm1/rootfs/rootä¸‹ç”¨äºå¯åŠ¨RFclient ï¼ˆè„šæœ¬å†…å®¹ï¼šsleep 5
/opt/rfclient/rfclient&amp;gt; /var/log/rfclient.logï¼‰
å¯åŠ¨pox
#ä½œä¸ºæ§åˆ¶å™¨appçš„RFproxyä¹Ÿéšä¹‹å¯åŠ¨,æ§åˆ¶å™¨æ—¥å¿—ç­‰çº§è®¾ä¸ºINFO
wait_port_listen $Contorller_PORT(6633)
å¯åŠ¨rfserver
./rfserver/rfserver.py rftest/rftest1config.csv &amp;amp;
# rftest1config.csvæ˜¯vm_id,vm_port,ct_id,dp_id,dp_portæ˜ å°„è¡¨
å¯åŠ¨å®¹å™¨å¹¶ç™»å½•ï¼šlxc-start -n rfvm1 -d
&lt;/code>&lt;/pre>
&lt;p>ä¸‰ã€è¿æ¥å®¹å™¨åˆ°æ­£åœ¨è¿è¡Œæ•°æ®åº“æœåŠ¡çš„hosts&lt;/p>
&lt;pre>&lt;code class="language-sh">ovsæ·»åŠ ç½‘æ¡¥dp0ï¼Œç«¯å£rfvm1.1ï¼Œrfvm1.2,dpid=7266767372667673
dp0è¿æ¥æ§åˆ¶å™¨ï¼šovs-vsctl set-controller dp0 tcp:127.0.0.1:$CONTROLLER_PORTï¼ˆ6633ï¼‰
å¯åŠ¨hostsï¼ˆå®¹å™¨b1ã€b2)
ovsæ·»åŠ ç½‘æ¡¥switch1,ç«¯å£b1.0ã€b2.0ï¼Œdpid=99
switch1è¿æ¥åˆ°æ§åˆ¶å™¨
&lt;/code>&lt;/pre>
&lt;p>åœ¨hoståˆ›å»ºovsç½‘æ¡¥ï¼Œè¿æ¥&lt;em>å®¹å™¨çš„ç®¡ç†æ¥å£&lt;/em>ï¼ˆrfvm1çš„eth0ï¼‰
&lt;strong>br0&lt;/strong>ï¼Œ192.169.1.1ï¼Œè¿™ä¸ªåœ°å€è¢«å†™æ­»åœ¨rflib/defs.hï¼ˆç»™RFclientå’ŒNOX-RFproxyä»¥åŠRFserverå’ŒPOX-RFproxyï¼‰
å››ã€ç™»å½•åˆ°å®¹å™¨host1
lxc-console -n b1ï¼ˆç”¨æˆ·åå¯†ç éƒ½æ˜¯ubuntuï¼‰
åœ¨b1ï¼ˆ172.31.1.2ï¼‰é‡Œping -c 3 172.31.2.2ï¼ˆb2ï¼‰&lt;/p>
&lt;p>pingé€šçš„åŸå› ï¼š
rfserverç»´æŠ¤æ˜ å°„è¡¨&lt;/p>
&lt;table>
&lt;thead>
&lt;tr>
&lt;th>vm_id&lt;/th>
&lt;th>vm_port&lt;/th>
&lt;th>ct_id&lt;/th>
&lt;th>dp_id,dp_port&lt;/th>
&lt;/tr>
&lt;/thead>
&lt;tbody>
&lt;tr>
&lt;td>12A0A0A0A0A0&lt;/td>
&lt;td>1&lt;/td>
&lt;td>0&lt;/td>
&lt;td>99&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>12A0A0A0A0A0&lt;/td>
&lt;td>2&lt;/td>
&lt;td>0&lt;/td>
&lt;td>99&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>å®¹å™¨idæ˜¯12A0A0A0A0A0ï¼Œå®ƒçš„æ¥å£eth1å¯¹åº”dpidï¼ˆswitchï¼‰çš„æ¥å£1,&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;tr>
&lt;td>æ¥å£eth2å¯¹åº”dpidï¼ˆswitchï¼‰çš„æ¥å£2&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;td>&lt;/td>
&lt;/tr>
&lt;/tbody>
&lt;/table>
&lt;p>Did you find this page helpful? Consider sharing it ğŸ™Œ&lt;/p></description></item></channel></rss>